<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css">

  <meta charset="utf-8">
  <title>Owner Dashboard</title>
</head>
<body>
  <h2>Welcome to Your Dashboard</h2>
  <p>Your client form link:</p>
  <p id="shareLink" style="font-weight:bold;color:blue;"></p>

  <h3>Your Clients</h3>
  <ul id="clientList"></ul>

  <button id="logout">Logout</button>
<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const shareLinkElement = document.getElementById("shareLink");
  const clientList = document.getElementById("clientList");

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    // ✅ Generate the owner’s personal link
    const baseUrl = window.location.origin;  // this gives https://francis2150.github.io
    const repoName = window.location.pathname.split("/")[1]; // this gives "trial"
    const formLink = `${baseUrl}/${repoName}/client-form.html?owner=${user.uid}`;

    // ✅ Display the link on dashboard
    shareLinkElement.innerHTML = `
      <a href="${formLink}" target="_blank">${formLink}</a>
      <button id="copyLink">Copy</button>
    `;

    // ✅ Copy link button
    document.getElementById("copyLink").addEventListener("click", () => {
      navigator.clipboard.writeText(formLink);
      alert("Link copied to clipboard!");
    });

    // ✅ Load client list for this user
    const snapshot = await getDocs(collection(db, "owners", user.uid, "clients"));
    clientList.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const li = document.createElement("li");
      li.textContent = `${data.name} - ${data.email}`;
      clientList.appendChild(li);
    });
  });

  // ✅ Logout
  document.getElementById("logout").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });
</script>

</body>
</html>
